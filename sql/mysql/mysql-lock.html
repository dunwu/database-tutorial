<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql жћЂ | DB-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/db-tutorial/favicon.ico">
    <meta name="description" content="ТЋ░ТЇ«т║ЊТЋЎуеІ">
    
    <link rel="preload" href="/db-tutorial/assets/css/0.styles.23083d05.css" as="style"><link rel="preload" href="/db-tutorial/assets/js/app.79266cfb.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/4.26b0a8d7.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/61.75308f0a.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/5.1e6b02f3.js" as="script"><link rel="prefetch" href="/db-tutorial/assets/js/10.e898170f.js"><link rel="prefetch" href="/db-tutorial/assets/js/11.632c95d5.js"><link rel="prefetch" href="/db-tutorial/assets/js/12.460e4723.js"><link rel="prefetch" href="/db-tutorial/assets/js/13.02572243.js"><link rel="prefetch" href="/db-tutorial/assets/js/14.c6190d41.js"><link rel="prefetch" href="/db-tutorial/assets/js/15.a381db4a.js"><link rel="prefetch" href="/db-tutorial/assets/js/16.88f06b5b.js"><link rel="prefetch" href="/db-tutorial/assets/js/17.8baa2e66.js"><link rel="prefetch" href="/db-tutorial/assets/js/18.ee71ad12.js"><link rel="prefetch" href="/db-tutorial/assets/js/19.2462d2be.js"><link rel="prefetch" href="/db-tutorial/assets/js/20.a06d0360.js"><link rel="prefetch" href="/db-tutorial/assets/js/21.3ac751e1.js"><link rel="prefetch" href="/db-tutorial/assets/js/22.1f1b2c8a.js"><link rel="prefetch" href="/db-tutorial/assets/js/23.2cf83d37.js"><link rel="prefetch" href="/db-tutorial/assets/js/24.fe279a90.js"><link rel="prefetch" href="/db-tutorial/assets/js/25.a5d7cfb6.js"><link rel="prefetch" href="/db-tutorial/assets/js/26.25a48ed2.js"><link rel="prefetch" href="/db-tutorial/assets/js/27.c589035a.js"><link rel="prefetch" href="/db-tutorial/assets/js/28.7a2cd641.js"><link rel="prefetch" href="/db-tutorial/assets/js/29.6f930670.js"><link rel="prefetch" href="/db-tutorial/assets/js/30.23b2927a.js"><link rel="prefetch" href="/db-tutorial/assets/js/31.31a1f172.js"><link rel="prefetch" href="/db-tutorial/assets/js/32.2986bb34.js"><link rel="prefetch" href="/db-tutorial/assets/js/33.a9922464.js"><link rel="prefetch" href="/db-tutorial/assets/js/34.4b026973.js"><link rel="prefetch" href="/db-tutorial/assets/js/35.9dd2d462.js"><link rel="prefetch" href="/db-tutorial/assets/js/36.3e51ad0b.js"><link rel="prefetch" href="/db-tutorial/assets/js/37.0c75b4a6.js"><link rel="prefetch" href="/db-tutorial/assets/js/38.53aff2bf.js"><link rel="prefetch" href="/db-tutorial/assets/js/39.b34704c6.js"><link rel="prefetch" href="/db-tutorial/assets/js/40.d2692de9.js"><link rel="prefetch" href="/db-tutorial/assets/js/41.48788a1b.js"><link rel="prefetch" href="/db-tutorial/assets/js/42.4ed55a89.js"><link rel="prefetch" href="/db-tutorial/assets/js/43.bd1a75df.js"><link rel="prefetch" href="/db-tutorial/assets/js/44.331ac972.js"><link rel="prefetch" href="/db-tutorial/assets/js/45.74ff24a0.js"><link rel="prefetch" href="/db-tutorial/assets/js/46.d0d0837c.js"><link rel="prefetch" href="/db-tutorial/assets/js/47.d6b3ff5d.js"><link rel="prefetch" href="/db-tutorial/assets/js/48.08329437.js"><link rel="prefetch" href="/db-tutorial/assets/js/49.8ec348c2.js"><link rel="prefetch" href="/db-tutorial/assets/js/50.fff0c0fc.js"><link rel="prefetch" href="/db-tutorial/assets/js/51.a3a2bf3f.js"><link rel="prefetch" href="/db-tutorial/assets/js/52.1f69c2ef.js"><link rel="prefetch" href="/db-tutorial/assets/js/53.04bf3805.js"><link rel="prefetch" href="/db-tutorial/assets/js/54.c6869df0.js"><link rel="prefetch" href="/db-tutorial/assets/js/55.ad3df06e.js"><link rel="prefetch" href="/db-tutorial/assets/js/56.a8504152.js"><link rel="prefetch" href="/db-tutorial/assets/js/57.14be86b1.js"><link rel="prefetch" href="/db-tutorial/assets/js/58.66724307.js"><link rel="prefetch" href="/db-tutorial/assets/js/59.450b982a.js"><link rel="prefetch" href="/db-tutorial/assets/js/6.50ecdddf.js"><link rel="prefetch" href="/db-tutorial/assets/js/60.4dfd7c6f.js"><link rel="prefetch" href="/db-tutorial/assets/js/62.345c0394.js"><link rel="prefetch" href="/db-tutorial/assets/js/63.0070d071.js"><link rel="prefetch" href="/db-tutorial/assets/js/64.3aa1dc66.js"><link rel="prefetch" href="/db-tutorial/assets/js/65.ad503350.js"><link rel="prefetch" href="/db-tutorial/assets/js/66.df8cf248.js"><link rel="prefetch" href="/db-tutorial/assets/js/67.d286b25d.js"><link rel="prefetch" href="/db-tutorial/assets/js/68.f9f672df.js"><link rel="prefetch" href="/db-tutorial/assets/js/69.cdabedef.js"><link rel="prefetch" href="/db-tutorial/assets/js/7.d4495af0.js"><link rel="prefetch" href="/db-tutorial/assets/js/8.96971897.js"><link rel="prefetch" href="/db-tutorial/assets/js/9.2ef68944.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~flowchart.36848b96.js"><link rel="prefetch" href="/db-tutorial/assets/js/vendors~notification.5e49bf43.js">
    <link rel="stylesheet" href="/db-tutorial/assets/css/0.styles.23083d05.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-tutorial/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="DB-TUTORIAL" class="logo"> <span class="site-name can-hide">DB-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/db-tutorial/sql/" class="nav-link router-link-active">
  SQL
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/" class="nav-link">
  NOSQL
</a></div><div class="nav-item"><a href="/db-tutorial/sql/mysql/" class="nav-link router-link-active">
  Mysql
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/mongodb/" class="nav-link">
  MongoDB
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ­Ъј» тЇџт«б
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/db-tutorial/sql/" class="nav-link router-link-active">
  SQL
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/" class="nav-link">
  NOSQL
</a></div><div class="nav-item"><a href="/db-tutorial/sql/mysql/" class="nav-link router-link-active">
  Mysql
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/db-tutorial/nosql/mongodb/" class="nav-link">
  MongoDB
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ­Ъј» тЇџт«б
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Mysql жћЂ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_1-Тѓ▓УДѓжћЂтњїС╣љУДѓжћЂ" class="sidebar-link">1. Тѓ▓УДѓжћЂтњїС╣љУДѓжћЂ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_2-УАеу║ДжћЂтњїУАїу║ДжћЂ" class="sidebar-link">2. УАеу║ДжћЂтњїУАїу║ДжћЂ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_3-У»╗тєЎжћЂ" class="sidebar-link">3. У»╗тєЎжћЂ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_4-ТёЈтљЉжћЂ" class="sidebar-link">4. ТёЈтљЉжћЂ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_5-mvcc" class="sidebar-link">5. MVCC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-tutorial/sql/mysql/mysql-lock.html#_5-1-mvcc-ТђЮТЃ│" class="sidebar-link">5.1. MVCC ТђЮТЃ│</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/sql/mysql/mysql-lock.html#_5-2-уЅѕТюгтЈи" class="sidebar-link">5.2. уЅѕТюгтЈи</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/sql/mysql/mysql-lock.html#_5-3-undo-ТЌЦт┐Ќ" class="sidebar-link">5.3. Undo ТЌЦт┐Ќ</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/sql/mysql/mysql-lock.html#_5-4-readview" class="sidebar-link">5.4. ReadView</a></li><li class="sidebar-sub-header"><a href="/db-tutorial/sql/mysql/mysql-lock.html#_5-5-т┐ФуЁДУ»╗СИјтйЊтЅЇУ»╗" class="sidebar-link">5.5. т┐ФуЁДУ»╗СИјтйЊтЅЇУ»╗</a></li></ul></li><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_6-УАїжћЂ" class="sidebar-link">6. УАїжћЂ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/db-tutorial/sql/mysql/mysql-lock.html#_7-тЈѓУђЃУхёТќЎ" class="sidebar-link">7. тЈѓУђЃУхёТќЎ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-жћЂ"><a href="#mysql-жћЂ" class="header-anchor">#</a> Mysql жћЂ</h1> <p><img src="http://dunwu.test.upcdn.net/snap/20200716064947.png" alt="img"></p> <ul><li><a href="#1-%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81">1. Тѓ▓УДѓжћЂтњїС╣љУДѓжћЂ</a></li> <li><a href="#2-%E8%A1%A8%E7%BA%A7%E9%94%81%E5%92%8C%E8%A1%8C%E7%BA%A7%E9%94%81">2. УАеу║ДжћЂтњїУАїу║ДжћЂ</a></li> <li><a href="#3-%E8%AF%BB%E5%86%99%E9%94%81">3. У»╗тєЎжћЂ</a></li> <li><a href="#4-%E6%84%8F%E5%90%91%E9%94%81">4. ТёЈтљЉжћЂ</a></li> <li><a href="#5-mvcc">5. MVCC</a> <ul><li><a href="#51-mvcc-%E6%80%9D%E6%83%B3">5.1. MVCC ТђЮТЃ│</a></li> <li><a href="#52-%E7%89%88%E6%9C%AC%E5%8F%B7">5.2. уЅѕТюгтЈи</a></li> <li><a href="#53-undo-%E6%97%A5%E5%BF%97">5.3. Undo ТЌЦт┐Ќ</a></li> <li><a href="#54-readview">5.4. ReadView</a></li> <li><a href="#55-%E5%BF%AB%E7%85%A7%E8%AF%BB%E4%B8%8E%E5%BD%93%E5%89%8D%E8%AF%BB">5.5. т┐ФуЁДУ»╗СИјтйЊтЅЇУ»╗</a></li></ul></li> <li><a href="#6-%E8%A1%8C%E9%94%81">6. УАїжћЂ</a></li> <li><a href="#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. тЈѓУђЃУхёТќЎ</a></li></ul> <h2 id="_1-Тѓ▓УДѓжћЂтњїС╣љУДѓжћЂ"><a href="#_1-Тѓ▓УДѓжћЂтњїС╣љУДѓжћЂ" class="header-anchor">#</a> 1. Тѓ▓УДѓжћЂтњїС╣љУДѓжћЂ</h2> <p>уА«С┐ЮтюетцџСИфС║ІтіАтљїТЌХтГўтЈќТЋ░ТЇ«т║ЊСИГтљїСИђТЋ░ТЇ«ТЌХСИЇуа┤тЮЈС║ІтіАуџёжџћуд╗ТђДтњїу╗ЪСИђТђДС╗ЦтЈіТЋ░ТЇ«т║Њуџёу╗ЪСИђТђД№╝ї<strong>С╣љУДѓжћЂтњїТѓ▓УДѓжћЂТў»т╣ХтЈЉТјДтѕХСИ╗УдЂжЄЄућеуџёТіђТю»ТЅІТ«хсђѓ</strong></p> <ul><li><strong><code>Тѓ▓УДѓжћЂ</code></strong> - тЂЄт«џС╝џтЈЉућЪт╣ХтЈЉтє▓уфЂ№╝їт▒ЈУћйСИђтѕЄтЈ»УЃйУ┐ЮтЈЇТЋ░ТЇ«т«їТЋ┤ТђДуџёТЊЇСйю
<ul><li>тюеТЪЦУ»бт«їТЋ░ТЇ«уџёТЌХтђЎт░▒ТііС║ІтіАжћЂУхиТЮЦ№╝їуЏ┤тѕ░ТЈљС║цС║ІтіА№╝ѕ<code>COMMIT</code>№╝Ѕ</li> <li>т«ъуј░Тќ╣т╝Ј№╝џ<strong>Сй┐ућеТЋ░ТЇ«т║ЊСИГуџёжћЂТю║тѕХ</strong>сђѓ</li></ul></li> <li><strong><code>С╣љУДѓжћЂ</code></strong> - тЂЄУ«ЙСИЇС╝џтЈЉућЪт╣ХтЈЉтє▓уфЂ№╝їтЈфтюеТЈљС║цТЊЇСйюТЌХТБђТЪЦТў»тљдУ┐ЮтЈЇТЋ░ТЇ«т«їТЋ┤ТђДсђѓ
<ul><li>тюеС┐«Тћ╣ТЋ░ТЇ«уџёТЌХтђЎТііС║ІтіАжћЂУхиТЮЦ№╝їжђџУ┐Є version уџёТќ╣т╝ЈТЮЦУ┐ЏУАїжћЂт«џ</li> <li>т«ъуј░Тќ╣т╝Ј№╝џ<strong>Сй┐уће version уЅѕТюгТѕќУђЁТЌХжЌ┤Тѕ│</strong>сђѓ</li></ul></li></ul> <p>сђљуц║СЙІсђЉС╣љУДѓжћЂуц║СЙІ</p> <p>тЋєтЊЂ goods УАеСИГТюЅСИђСИфтГЌТ«х status№╝їstatus СИ║ 1 С╗БУАетЋєтЊЂТюфУбФСИІтЇЋ№╝їstatus СИ║ 2 С╗БУАетЋєтЊЂти▓у╗ЈУбФСИІтЇЋ№╝їжѓБС╣ѕТѕЉС╗гт»╣ТЪљСИфтЋєтЊЂСИІтЇЋТЌХт┐ЁжА╗уА«С┐ЮУ»ЦтЋєтЊЂ status СИ║ 1сђѓтЂЄУ«ЙтЋєтЊЂуџё id СИ║ 1сђѓ</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">status</span><span class="token punctuation">,</span><span class="token keyword">status</span><span class="token punctuation">,</span>version<span class="token punctuation">)</span> <span class="token keyword">from</span> t_goods <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token comment">#{id}</span>

<span class="token keyword">update</span> t_goods
<span class="token keyword">set</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>version<span class="token operator">=</span>version<span class="token operator">+</span><span class="token number">1</span>
<span class="token keyword">where</span> id<span class="token operator">=</span><span class="token comment">#{id} and version=#{version};</span>
</code></pre></div><blockquote><p>ТЏ┤У»ду╗єуџёС╣љУДѓжћЂУ»┤тЈ»С╗ЦтЈѓУђЃ№╝џ<a href="https://www.cnblogs.com/laoyeye/p/8097684.html" target="_blank" rel="noopener noreferrer">Сй┐уће mysql С╣љУДѓжћЂУДБтє│т╣ХтЈЉжЌ«жбў<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="_2-УАеу║ДжћЂтњїУАїу║ДжћЂ"><a href="#_2-УАеу║ДжћЂтњїУАїу║ДжћЂ" class="header-anchor">#</a> 2. УАеу║ДжћЂтњїУАїу║ДжћЂ</h2> <p>С╗јТЋ░ТЇ«т║ЊуџёжћЂу▓њт║дТЮЦуюІ№╝їMySQL СИГТЈљСЙЏС║єСИцуДЇт░ЂжћЂу▓њт║д№╝џУАїу║ДжћЂтњїУАеу║ДжћЂсђѓ</p> <ul><li><strong>УАеу║ДжћЂ№╝ѕtable lock№╝Ѕ</strong> - жћЂт«џТЋ┤т╝аУАесђѓућеТѕит»╣УАеУ┐ЏУАїтєЎТЊЇСйютЅЇ№╝їжюђУдЂтЁѕУјитЙЌтєЎжћЂ№╝їУ┐ЎС╝џжў╗тАътЁХС╗ќућеТѕит»╣У»ЦУАеуџёТЅђТюЅУ»╗тєЎТЊЇСйюсђѓтЈфТюЅТ▓АТюЅтєЎжћЂТЌХ№╝їтЁХС╗ќућеТѕиТЅЇУЃйУјитЙЌУ»╗жћЂ№╝їУ»╗жћЂС╣ІжЌ┤СИЇС╝џуЏИС║њжў╗тАъсђѓ</li> <li><strong>УАїу║ДжћЂ№╝ѕrow lock№╝Ѕ</strong> - жћЂт«џТїЄт«џуџёУАїУ«░тйЋсђѓУ┐ЎТаитЁХт«ЃУ┐ЏуеІУ┐ўТў»тЈ»С╗Цт»╣тљїСИђСИфУАеСИГуџётЁХт«ЃУ«░тйЋУ┐ЏУАїТЊЇСйюсђѓ</li></ul> <p>т║ћУ»Цт░йжЄЈтЈфжћЂт«џжюђУдЂС┐«Тћ╣уџёжѓБжЃетѕєТЋ░ТЇ«№╝їУђїСИЇТў»ТЅђТюЅуџёУхёТ║љсђѓ<strong>жћЂт«џуџёТЋ░ТЇ«жЄЈУХіт░Љ№╝їжћЂуФъС║ЅуџётЈЉућЪжбЉујЄт░▒УХіт░Ј№╝їу│╗у╗Ъуџёт╣ХтЈЉуеІт║дт░▒УХіжФў</strong>сђѓСйєТў»тіажћЂжюђУдЂТХѕУђЌУхёТ║љ№╝їжћЂуџётљёуДЇТЊЇСйю№╝ѕтїЁТІгУјитЈќжћЂсђЂжЄіТћЙжћЂсђЂС╗ЦтЈіТБђТЪЦжћЂуіХТђЂ№╝ЅжЃйС╝џтбътіау│╗у╗Ът╝ђжћђсђѓтЏаТГц<strong>жћЂу▓њт║дУХіт░Ј№╝їу│╗у╗Ът╝ђжћђт░▒УХітцД</strong>сђѓ</p> <p>тюежђЅТІЕжћЂу▓њт║дТЌХ№╝їжюђУдЂтюежћЂт╝ђжћђтњїт╣ХтЈЉуеІт║дС╣ІжЌ┤тЂџСИђСИфТЮЃУААсђѓ</p> <p>тюе <code>InnoDB</code> СИГ№╝ї<strong>УАїжћЂТў»жђџУ┐Єу╗Ўу┤бт╝ЋСИіуџёу┤бт╝ЋжА╣тіажћЂТЮЦт«ъуј░уџё</strong>сђѓ<strong>тдѓТъюТ▓АТюЅу┤бт╝Ћ№╝ї<code>InnoDB</code> т░єС╝џжђџУ┐ЄжџљУЌЈуџёУЂџу░Єу┤бт╝ЋТЮЦт»╣У«░тйЋтіажћЂ</strong>сђѓ</p> <h2 id="_3-У»╗тєЎжћЂ"><a href="#_3-У»╗тєЎжћЂ" class="header-anchor">#</a> 3. У»╗тєЎжћЂ</h2> <ul><li>уІгС║ФжћЂ№╝ѕExclusive№╝Ѕ№╝їу«ђтєЎСИ║ X жћЂ№╝їтЈѕуД░тєЎжћЂсђѓСй┐ућеТќ╣т╝Ј№╝џ<code>SELECT ... FOR UPDATE;</code></li> <li>тЁ▒С║ФжћЂ№╝ѕShared№╝Ѕ№╝їу«ђтєЎСИ║ S жћЂ№╝їтЈѕуД░У»╗жћЂсђѓСй┐ућеТќ╣т╝Ј№╝џ<code>SELECT ... LOCK IN SHARE MODE;</code></li></ul> <p>тєЎжћЂтњїУ»╗жћЂуџётЁ│у│╗№╝їу«ђУеђС╣І№╝џ<strong>уІгС║ФжћЂтГўтюе№╝їтЁХС╗ќС║ІтіАт░▒СИЇУЃйтЂџС╗╗СйЋТЊЇСйю</strong>сђѓ</p> <p><strong><code>InnoDB</code> СИІуџёУАїжћЂсђЂжЌ┤жџЎжћЂсђЂnext-key жћЂу╗Ъу╗Ът▒ъС║јуІгС║ФжћЂ</strong>сђѓ</p> <h2 id="_4-ТёЈтљЉжћЂ"><a href="#_4-ТёЈтљЉжћЂ" class="header-anchor">#</a> 4. ТёЈтљЉжћЂ</h2> <p><strong>тйЊтГўтюеУАеу║ДжћЂтњїУАїу║ДжћЂуџёТЃЁтєхСИІ№╝їт┐ЁжА╗тЁѕућ│У»иТёЈтљЉжћЂ№╝ѕУАеу║ДжћЂ№╝їСйєСИЇТў»уюЪуџётіажћЂ№╝Ѕ№╝їтєЇУјитЈќУАїу║ДжћЂ</strong>сђѓСй┐ућеТёЈтљЉжћЂ№╝ѕIntention Locks№╝ЅтЈ»С╗ЦТЏ┤т«╣ТўЊтю░Тћ»ТїЂтцџу▓њт║дт░ЂжћЂсђѓ</p> <p><strong>ТёЈтљЉжћЂТў» <code>InnoDB</code> УЄфтіетіауџё№╝їСИЇжюђУдЂућеТѕит╣▓жбё</strong>сђѓ</p> <p>тюетГўтюеУАїу║ДжћЂтњїУАеу║ДжћЂуџёТЃЁтєхСИІ№╝їС║ІтіА T ТЃ│УдЂт»╣УАе A тіа X жћЂ№╝їт░▒жюђУдЂтЁѕТБђТхІТў»тљдТюЅтЁХт«ЃС║ІтіАт»╣УАе A ТѕќУђЁУАе A СИГуџёС╗╗ТёЈСИђУАїтіаС║єжћЂ№╝їжѓБС╣ѕт░▒жюђУдЂт»╣УАе A уџёТ»ЈСИђУАїжЃйТБђТхІСИђТгА№╝їУ┐ЎТў»жЮътИИУђЌТЌХуџёсђѓ</p> <p>ТёЈтљЉжћЂУДёт«џ№╝џ</p> <ul><li>IX/IS Тў»УАежћЂ№╝Џ</li> <li>X/S Тў»УАїжћЂсђѓ</li> <li>СИђСИфС║ІтіАтюеУјитЙЌТЪљСИфТЋ░ТЇ«УАїуџё S жћЂС╣ІтЅЇ№╝їт┐ЁжА╗тЁѕУјитЙЌУАеуџё IS жћЂТѕќУђЁТЏ┤т╝║уџёжћЂ№╝Џ</li> <li>СИђСИфС║ІтіАтюеУјитЙЌТЪљСИфТЋ░ТЇ«УАїуџё X жћЂС╣ІтЅЇ№╝їт┐ЁжА╗тЁѕУјитЙЌУАеуџё IX жћЂсђѓ</li></ul> <p>жђџУ┐Єт╝ЋтЁЦТёЈтљЉжћЂ№╝їС║ІтіА T ТЃ│УдЂт»╣УАе A тіа X жћЂ№╝їтЈфжюђУдЂтЁѕТБђТхІТў»тљдТюЅтЁХт«ЃС║ІтіАт»╣УАе A тіаС║є X/IX/S/IS жћЂ№╝їтдѓТъютіаС║єт░▒УАеуц║ТюЅтЁХт«ЃС║ІтіАТГБтюеСй┐ућеУ┐ЎСИфУАеТѕќУђЁУАеСИГТЪљСИђУАїуџёжћЂ№╝їтЏаТГцС║ІтіА T тіа X жћЂтц▒У┤Цсђѓ</p> <p>тљёуДЇжћЂуџётЁ╝т«╣тЁ│у│╗тдѓСИІ№╝џ</p> <table><thead><tr><th style="text-align:center;">-</th> <th style="text-align:center;">X</th> <th style="text-align:center;">IX</th> <th style="text-align:center;">S</th> <th style="text-align:center;">IS</th></tr></thead> <tbody><tr><td style="text-align:center;">X</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">РЮї</td></tr> <tr><td style="text-align:center;">IX</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">Рюћ№ИЈ</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">Рюћ№ИЈ</td></tr> <tr><td style="text-align:center;">S</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">Рюћ№ИЈ</td> <td style="text-align:center;">Рюћ№ИЈ</td></tr> <tr><td style="text-align:center;">IS</td> <td style="text-align:center;">РЮї</td> <td style="text-align:center;">Рюћ№ИЈ</td> <td style="text-align:center;">Рюћ№ИЈ</td> <td style="text-align:center;">Рюћ№ИЈ</td></tr></tbody></table> <p>УДБжЄітдѓСИІ№╝џ</p> <ul><li>С╗╗ТёЈ IS/IX жћЂС╣ІжЌ┤жЃйТў»тЁ╝т«╣уџё№╝їтЏаСИ║т«ЃС╗гтЈфУАеуц║ТЃ│УдЂт»╣УАетіажћЂ№╝їУђїСИЇТў»уюЪТГБтіажћЂ№╝Џ</li> <li>У┐ЎжЄїтЁ╝т«╣тЁ│у│╗жњѕт»╣уџёТў»УАеу║ДжћЂ№╝їУђїУАеу║Дуџё IX жћЂтњїУАїу║Дуџё X жћЂтЁ╝т«╣№╝їСИцСИфС║ІтіАтЈ»С╗Цт»╣СИцСИфТЋ░ТЇ«УАїтіа X жћЂсђѓ№╝ѕС║ІтіА T1 ТЃ│УдЂт»╣ТЋ░ТЇ«УАї R1 тіа X жћЂ№╝їС║ІтіА T2 ТЃ│УдЂт»╣тљїСИђСИфУАеуџёТЋ░ТЇ«УАї R2 тіа X жћЂ№╝їСИцСИфС║ІтіАжЃйжюђУдЂт»╣У»ЦУАетіа IX жћЂ№╝їСйєТў» IX жћЂТў»тЁ╝т«╣уџё№╝їт╣ХСИћ IX жћЂСИјУАїу║Дуџё X жћЂС╣ЪТў»тЁ╝т«╣уџё№╝їтЏаТГцСИцСИфС║ІтіАжЃйУЃйтіажћЂТѕљтіЪ№╝їт»╣тљїСИђСИфУАеСИГуџёСИцСИфТЋ░ТЇ«УАїтЂџС┐«Тћ╣сђѓ№╝Ѕ</li></ul> <h2 id="_5-mvcc"><a href="#_5-mvcc" class="header-anchor">#</a> 5. MVCC</h2> <p><strong>тцџуЅѕТюгт╣ХтЈЉТјДтѕХ№╝ѕMulti-Version Concurrency Control, MVCC№╝ЅтЈ»С╗ЦУДєСИ║УАїу║ДжћЂуџёСИђСИфтЈўуДЇсђѓт«ЃтюетЙѕтцџТЃЁтєхСИІжЃйжЂ┐тЁЇС║єтіажћЂТЊЇСйю№╝їтЏаТГцт╝ђжћђТЏ┤Сйј</strong>сђѓСИЇС╗ЁТў» Mysql№╝їтїЁТІг OracleсђЂPostgreSQL уГЅтЁХС╗ќТЋ░ТЇ«т║ЊжЃйт«ъуј░С║єтљёУЄфуџё MVCC№╝їт«ъуј░Тю║тѕХТ▓АТюЅу╗ЪСИђТаЄтЄєсђѓ</p> <p>MVCC Тў» <code>InnoDB</code> тГўтѓет╝ЋТЊјт«ъуј░жџћуд╗у║ДтѕФуџёСИђуДЇтЁиСйЊТќ╣т╝Ј№╝ї<strong>ућеС║јт«ъуј░ТЈљС║цУ»╗тњїтЈ»жЄЇтцЇУ»╗У┐ЎСИцуДЇжџћуд╗у║ДтѕФ</strong>сђѓУђїТюфТЈљС║цУ»╗жџћуд╗у║ДтѕФТђ╗Тў»У»╗тЈќТюђТќ░уџёТЋ░ТЇ«УАї№╝їУдЂТ▒ѓтЙѕСйј№╝їТЌажюђСй┐уће MVCCсђѓтЈ»СИ▓УАїтїќжџћуд╗у║ДтѕФжюђУдЂт»╣ТЅђТюЅУ»╗тЈќуџёУАїжЃйтіажћЂ№╝їтЇЋу║»Сй┐уће MVCC ТЌаТ│Ћт«ъуј░сђѓ</p> <h3 id="_5-1-mvcc-ТђЮТЃ│"><a href="#_5-1-mvcc-ТђЮТЃ│" class="header-anchor">#</a> 5.1. MVCC ТђЮТЃ│</h3> <p>тіажћЂУЃйУДБтє│тцџСИфС║ІтіАтљїТЌХТЅДУАїТЌХтЄ║уј░уџёт╣ХтЈЉСИђУЄ┤ТђДжЌ«жбўсђѓтюет«ъжЎЁтю║ТЎ»СИГУ»╗ТЊЇСйютЙђтЙђтцџС║јтєЎТЊЇСйю№╝їтЏаТГцтЈѕт╝ЋтЁЦС║єУ»╗тєЎжћЂТЮЦжЂ┐тЁЇСИЇт┐ЁУдЂуџётіажћЂТЊЇСйю№╝їСЙІтдѓУ»╗тњїУ»╗Т▓АТюЅС║њТќЦтЁ│у│╗сђѓУ»╗тєЎжћЂСИГУ»╗тњїтєЎТЊЇСйюС╗ЇуёХТў»С║њТќЦуџёсђѓ</p> <p>MVCC уџёТђЮТЃ│Тў»№╝џ</p> <ul><li><strong>С┐ЮтГўТЋ░ТЇ«тюеТЪљСИфТЌХжЌ┤уѓ╣уџёт┐ФуЁД№╝їтєЎТЊЇСйю№╝ѕDELETEсђЂINSERTсђЂUPDATE№╝ЅТЏ┤Тќ░ТюђТќ░уџёуЅѕТюгт┐ФуЁД№╝ЏУђїУ»╗ТЊЇСйютј╗У»╗ТЌДуЅѕТюгт┐ФуЁД№╝їТ▓АТюЅС║њТќЦтЁ│у│╗</strong>сђѓУ┐ЎСИђуѓ╣тњї <code>CopyOnWrite</code> у▒╗С╝╝сђѓ</li> <li>УёЈУ»╗тњїСИЇтЈ»жЄЇтцЇУ»╗ТюђТа╣ТюгуџётјЪтЏаТў»<strong>С║ІтіАУ»╗тЈќтѕ░тЁХт«ЃС║ІтіАТюфТЈљС║цуџёС┐«Тћ╣</strong>сђѓтюеС║ІтіАУ┐ЏУАїУ»╗тЈќТЊЇСйюТЌХ№╝їСИ║С║єУДБтє│УёЈУ»╗тњїСИЇтЈ»жЄЇтцЇУ»╗жЌ«жбў№╝ї<strong>MVCC УДёт«џтЈфУЃйУ»╗тЈќти▓у╗ЈТЈљС║цуџёт┐ФуЁД</strong>сђѓтйЊуёХСИђСИфС║ІтіАтЈ»С╗ЦУ»╗тЈќУЄфУ║ФТюфТЈљС║цуџёт┐ФуЁД№╝їУ┐ЎСИЇу«ЌТў»УёЈУ»╗сђѓ</li></ul> <h3 id="_5-2-уЅѕТюгтЈи"><a href="#_5-2-уЅѕТюгтЈи" class="header-anchor">#</a> 5.2. уЅѕТюгтЈи</h3> <p>InnoDB уџё MVCC т«ъуј░Тў»№╝џтюеТ»ЈУАїУ«░тйЋтљјжЮбС┐ЮтГўСИцСИфжџљУЌЈтѕЌ№╝їСИђСИфтѕЌС┐ЮтГўУАїуџётѕЏт╗║ТЌХжЌ┤№╝їтЈдСИђСИфтѕЌС┐ЮтГўУАїуџёУ┐ЄТюЪТЌХжЌ┤№╝ѕУ┐ЎжЄїуџёТЌХжЌ┤Тў»ТїЄу│╗у╗ЪуЅѕТюгтЈи№╝ЅсђѓТ»Јт╝ђтДІСИђСИфТќ░С║ІтіА№╝їу│╗у╗ЪуЅѕТюгтЈиС╝џУЄфтіежђњтбъ№╝їС║ІтіАт╝ђтДІТЌХтѕ╗уџёу│╗у╗ЪуЅѕТюгтЈиС╝џСйюСИ║С║ІтіАуџёуЅѕТюгтЈи№╝їућеТЮЦтњїТЪЦУ»бтѕ░уџёТ»ЈУАїУ«░тйЋуџёуЅѕТюгтЈиУ┐ЏУАїТ»ћУЙЃсђѓ</p> <ul><li>у│╗у╗ЪуЅѕТюгтЈи <code>SYS_ID</code>№╝џТў»СИђСИфжђњтбъуџёТЋ░тГЌ№╝їТ»Јт╝ђтДІСИђСИфТќ░уџёС║ІтіА№╝їу│╗у╗ЪуЅѕТюгтЈит░▒С╝џУЄфтіежђњтбъсђѓ</li> <li>С║ІтіАуЅѕТюгтЈи <code>TRX_ID</code> №╝џС║ІтіАт╝ђтДІТЌХуџёу│╗у╗ЪуЅѕТюгтЈисђѓ</li></ul> <h3 id="_5-3-undo-ТЌЦт┐Ќ"><a href="#_5-3-undo-ТЌЦт┐Ќ" class="header-anchor">#</a> 5.3. Undo ТЌЦт┐Ќ</h3> <p>MVCC уџётцџуЅѕТюгТїЄуџёТў»тцџСИфуЅѕТюгуџёт┐ФуЁД№╝їт┐ФуЁДтГўтѓетюе Undo ТЌЦт┐ЌСИГ№╝їУ»ЦТЌЦт┐ЌжђџУ┐ЄтЏъТ╗џТїЄжњѕ <code>ROLL_PTR</code> ТііСИђСИфТЋ░ТЇ«УАїуџёТЅђТюЅт┐ФуЁДУ┐ъТјЦУхиТЮЦсђѓ</p> <p>СЙІтдѓтюе MySQL тѕЏт╗║СИђСИфУАе t№╝їтїЁтљФСИ╗жћ« id тњїСИђСИфтГЌТ«х xсђѓТѕЉС╗гтЁѕТЈњтЁЦСИђСИфТЋ░ТЇ«УАї№╝їуёХтљјт»╣У»ЦТЋ░ТЇ«УАїТЅДУАїСИцТгАТЏ┤Тќ░ТЊЇСйюсђѓ</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t<span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> t <span class="token keyword">SET</span> x<span class="token operator">=</span><span class="token string">&quot;b&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> t <span class="token keyword">SET</span> x<span class="token operator">=</span><span class="token string">&quot;c&quot;</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>тЏаСИ║Т▓АТюЅСй┐уће <code>START TRANSACTION</code> т░єСИіжЮбуџёТЊЇСйютйЊТѕљСИђСИфС║ІтіАТЮЦТЅДУАї№╝їТа╣ТЇ« MySQL уџё <code>AUTOCOMMIT</code> Тю║тѕХ№╝їТ»ЈСИфТЊЇСйюжЃйС╝џУбФтйЊТѕљСИђСИфС║ІтіАТЮЦТЅДУАї№╝їТЅђС╗ЦСИіжЮбуџёТЊЇСйюТђ╗тЁ▒ТХЅтЈітѕ░СИЅСИфС║ІтіАсђѓт┐ФуЁДСИГжЎцС║єУ«░тйЋС║ІтіАуЅѕТюгтЈи TRX_ID тњїТЊЇСйюС╣Ітцќ№╝їУ┐ўУ«░тйЋС║єСИђСИф bit уџё DEL тГЌТ«х№╝їућеС║јТаЄУ«░Тў»тљдУбФтѕажЎцсђѓ</p> <p><code>INSERT</code>сђЂ<code>UPDATE</code>сђЂ<code>DELETE</code> ТЊЇСйюС╝џтѕЏт╗║СИђСИфТЌЦт┐Ќ№╝їт╣Хт░єС║ІтіАуЅѕТюгтЈи <code>TRX_ID</code> тєЎтЁЦсђѓ<code>DELETE</code> тЈ»С╗ЦуюІТѕљТў»СИђСИфуЅ╣Т«іуџё <code>UPDATE</code>№╝їУ┐ўС╝џжбЮтцќт░є DEL тГЌТ«хУ«Йуй«СИ║ 1сђѓ</p> <h3 id="_5-4-readview"><a href="#_5-4-readview" class="header-anchor">#</a> 5.4. ReadView</h3> <p>MVCC у╗┤ТіцС║єСИђСИфСИђУЄ┤ТђДУ»╗УДєтЏЙ <code>consistent read view</code> №╝їСИ╗УдЂтїЁтљФС║єтйЊтЅЇу│╗у╗Ъ<strong>ТюфТЈљС║цуџёС║ІтіАтѕЌУАе</strong> <code>TRX_IDs {TRX_ID_1, TRX_ID_2, ...}</code>№╝їУ┐ўТюЅУ»ЦтѕЌУАеуџёТюђт░Јтђ╝ <code>TRX_ID_MIN</code> тњї <code>TRX_ID_MAX</code>сђѓ</p> <p><img src="http://dunwu.test.upcdn.net/snap/20200715135809.png" alt="img"></p> <p>У┐ЎТаи№╝їт»╣С║јтйЊтЅЇС║ІтіАуџётљ»тіеуъгжЌ┤ТЮЦУ»┤№╝їСИђСИфТЋ░ТЇ«уЅѕТюгуџё row trx_id№╝їТюЅС╗ЦСИІтЄауДЇтЈ»УЃй№╝џ</p> <ol><li>тдѓТъюУљйтюеу╗┐УЅ▓жЃетѕє№╝їУАеуц║У┐ЎСИфуЅѕТюгТў»ти▓ТЈљС║цуџёС║ІтіАТѕќУђЁТў»тйЊтЅЇС║ІтіАУЄфти▒ућЪТѕљуџё№╝їУ┐ЎСИфТЋ░ТЇ«Тў»тЈ»УДЂуџё№╝Џ</li> <li>тдѓТъюУљйтюеу║бУЅ▓жЃетѕє№╝їУАеуц║У┐ЎСИфуЅѕТюгТў»ућ▒т░єТЮЦтљ»тіеуџёС║ІтіАућЪТѕљуџё№╝їТў»Уѓ»т«џСИЇтЈ»УДЂуџё№╝Џ</li> <li>тдѓТъюУљйтюеж╗ёУЅ▓жЃетѕє№╝їжѓБт░▒тїЁТІгСИцуДЇТЃЁтєх
a. УІЦ row trx_id тюеТЋ░у╗ёСИГ№╝їУАеуц║У┐ЎСИфуЅѕТюгТў»ућ▒У┐ўТ▓АТЈљС║цуџёС║ІтіАућЪТѕљуџё№╝їСИЇтЈ»УДЂ№╝Џ
b. УІЦ row trx_id СИЇтюеТЋ░у╗ёСИГ№╝їУАеуц║У┐ЎСИфуЅѕТюгТў»ти▓у╗ЈТЈљС║цС║єуџёС║ІтіАућЪТѕљуџё№╝їтЈ»УДЂсђѓ</li></ol> <p>тюеУ┐ЏУАї <code>SELECT</code> ТЊЇСйюТЌХ№╝їТа╣ТЇ«ТЋ░ТЇ«УАїт┐ФуЁДуџё <code>TRX_ID</code> СИј <code>TRX_ID_MIN</code> тњї <code>TRX_ID_MAX</code> С╣ІжЌ┤уџётЁ│у│╗№╝їС╗јУђїтѕцТќГТЋ░ТЇ«УАїт┐ФуЁДТў»тљдтЈ»С╗ЦСй┐уће№╝џ</p> <ul><li><code>TRX_ID</code> &lt; <code>TRX_ID_MIN</code>№╝їУАеуц║У»ЦТЋ░ТЇ«УАїт┐ФуЁДТЌХтюетйЊтЅЇТЅђТюЅТюфТЈљС║цС║ІтіАС╣ІтЅЇУ┐ЏУАїТЏ┤Тћ╣уџё№╝їтЏаТГцтЈ»С╗ЦСй┐ућесђѓ</li> <li><code>TRX_ID</code> &gt; <code>TRX_ID_MAX</code>№╝їУАеуц║У»ЦТЋ░ТЇ«УАїт┐ФуЁДТў»тюеС║ІтіАтљ»тіеС╣ІтљјУбФТЏ┤Тћ╣уџё№╝їтЏаТГцСИЇтЈ»Сй┐ућесђѓ</li> <li><code>TRX_ID_MIN</code> &lt;= <code>TRX_ID</code> &lt;= <code>TRX_ID_MAX</code>№╝їжюђУдЂТа╣ТЇ«жџћуд╗у║ДтѕФтєЇУ┐ЏУАїтѕцТќГ№╝џ
<ul><li>ТЈљС║цУ»╗№╝џтдѓТъю <code>TRX_ID</code> тюе <code>TRX_IDs</code> тѕЌУАеСИГ№╝їУАеуц║У»ЦТЋ░ТЇ«УАїт┐ФуЁДт»╣т║ћуџёС║ІтіАУ┐ўТюфТЈљС║ц№╝їтѕЎУ»Цт┐ФуЁДСИЇтЈ»Сй┐ућесђѓтљдтѕЎУАеуц║ти▓у╗ЈТЈљС║ц№╝їтЈ»С╗ЦСй┐ућесђѓ</li> <li>тЈ»жЄЇтцЇУ»╗№╝џжЃйСИЇтЈ»С╗ЦСй┐ућесђѓтЏаСИ║тдѓТъютЈ»С╗ЦСй┐ућеуџёУ»Ю№╝їжѓБС╣ѕтЁХт«ЃС║ІтіАС╣ЪтЈ»С╗ЦУ»╗тѕ░У┐ЎСИфТЋ░ТЇ«УАїт┐ФуЁДт╣ХУ┐ЏУАїС┐«Тћ╣№╝їжѓБС╣ѕтйЊтЅЇС║ІтіАтєЇтј╗У»╗У┐ЎСИфТЋ░ТЇ«УАїтЙЌтѕ░уџётђ╝т░▒С╝џтЈЉућЪТћ╣тЈў№╝їС╣Ът░▒Тў»тЄ║уј░С║єСИЇтЈ»жЄЇтцЇУ»╗жЌ«жбўсђѓ</li></ul></li></ul> <p>тюеТЋ░ТЇ«УАїт┐ФуЁДСИЇтЈ»Сй┐ућеуџёТЃЁтєхСИІ№╝їжюђУдЂТ▓┐уЮђ Undo Log уџётЏъТ╗џТїЄжњѕ ROLL_PTR ТЅЙтѕ░СИІСИђСИфт┐ФуЁД№╝їтєЇУ┐ЏУАїСИіжЮбуџётѕцТќГсђѓ</p> <h3 id="_5-5-т┐ФуЁДУ»╗СИјтйЊтЅЇУ»╗"><a href="#_5-5-т┐ФуЁДУ»╗СИјтйЊтЅЇУ»╗" class="header-anchor">#</a> 5.5. т┐ФуЁДУ»╗СИјтйЊтЅЇУ»╗</h3> <p>т┐ФуЁДУ»╗</p> <p>MVCC уџё SELECT ТЊЇСйюТў»т┐ФуЁДСИГуџёТЋ░ТЇ«№╝їСИЇжюђУдЂУ┐ЏУАїтіажћЂТЊЇСйюсђѓ</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre></div><p>тйЊтЅЇУ»╗</p> <p>MVCC тЁХт«ЃС╝џт»╣ТЋ░ТЇ«т║ЊУ┐ЏУАїС┐«Тћ╣уџёТЊЇСйю№╝ѕINSERTсђЂUPDATEсђЂDELETE№╝ЅжюђУдЂУ┐ЏУАїтіажћЂТЊЇСйю№╝їС╗јУђїУ»╗тЈќТюђТќ░уџёТЋ░ТЇ«сђѓтЈ»С╗ЦуюІтѕ░ MVCC т╣ХСИЇТў»т«їтЁеСИЇућетіажћЂ№╝їУђїтЈфТў»жЂ┐тЁЇС║є SELECT уџётіажћЂТЊЇСйюсђѓ</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span><span class="token punctuation">;</span>
</code></pre></div><p>тюеУ┐ЏУАї SELECT ТЊЇСйюТЌХ№╝їтЈ»С╗Цт╝║тѕХТїЄт«џУ┐ЏУАїтіажћЂТЊЇСйюсђѓС╗ЦСИІуггСИђСИфУ»ГтЈЦжюђУдЂтіа S жћЂ№╝їуггС║їСИфжюђУдЂтіа X жћЂсђѓ</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> ? <span class="token keyword">lock</span> <span class="token operator">in</span> <span class="token keyword">share</span> <span class="token keyword">mode</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> ? <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6-УАїжћЂ"><a href="#_6-УАїжћЂ" class="header-anchor">#</a> 6. УАїжћЂ</h2> <p>УАїжћЂуџётЁиСйЊт«ъуј░у«ЌТ│ЋТюЅСИЅуДЇ№╝џrecord lockсђЂgap lock С╗ЦтЈі next-key lockсђѓ</p> <ul><li><code>Record Lock</code> - <strong>УАїжћЂт»╣у┤бт╝ЋжА╣тіажћЂ№╝їУІЦТ▓АТюЅу┤бт╝ЋтѕЎСй┐ућеУАежћЂ</strong>сђѓ</li> <li><code>Gap Lock</code> - <strong>т»╣у┤бт╝ЋжА╣С╣ІжЌ┤уџёжЌ┤жџЎтіажћЂ</strong>сђѓжћЂт«џу┤бт╝ЋС╣ІжЌ┤уџёжЌ┤жџЎ№╝їСйєТў»СИЇтїЁтљФу┤бт╝ЋТюгУ║ФсђѓСЙІтдѓтйЊСИђСИфС║ІтіАТЅДУАїС╗ЦСИІУ»ГтЈЦ№╝їтЁХт«ЃС║ІтіАт░▒СИЇУЃйтюе t.c СИГТЈњтЁЦ 15№╝џ<code>SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;</code>сђѓтюе MySQL СИГ№╝їgap lock ж╗ўУ«цТў»т╝ђтљ»уџё№╝їтЇ│ <code>innodb_locks_unsafe_for_binlog</code> тЈѓТЋ░тђ╝Тў» disable уџё№╝їСИћ MySQL СИГж╗ўУ«цуџёТў» RR С║ІтіАжџћуд╗у║ДтѕФсђѓ</li> <li><code>Next-key lock</code> -т«ЃТў» <code>Record Lock</code> тњї <code>Gap Lock</code> уџёу╗Њтљѕ№╝їСИЇС╗ЁжћЂт«џСИђСИфУ«░тйЋСИіуџёу┤бт╝Ћ№╝їС╣ЪжћЂт«џу┤бт╝ЋС╣ІжЌ┤уџёжЌ┤жџЎсђѓт«ЃжћЂт«џСИђСИфтЅЇт╝ђтљјжЌГтї║жЌ┤сђѓ</li></ul> <p>тЈфтюетЈ»жЄЇтцЇУ»╗ТѕќС╗ЦСИіжџћуд╗у║ДтѕФСИІуџёуЅ╣т«џТЊЇСйюТЅЇС╝џтЈќтЙЌ gap lock Тѕќ next-key lockсђѓтюе <code>Select</code>сђЂ<code>Update</code> тњї <code>Delete</code> ТЌХ№╝їжЎцС║єтЪ║С║јтћ»СИђу┤бт╝ЋуџёТЪЦУ»бС╣Ітцќ№╝їтЁХт«Ѓу┤бт╝ЋТЪЦУ»бТЌХжЃйС╝џУјитЈќ gap lock Тѕќ next-key lock№╝їтЇ│жћЂСйЈтЁХТЅФТЈЈуџёУїЃтЏ┤сђѓСИ╗жћ«у┤бт╝ЋС╣Ът▒ъС║јтћ»СИђу┤бт╝Ћ№╝їТЅђС╗ЦСИ╗жћ«у┤бт╝ЋТў»СИЇС╝џСй┐уће gap lock Тѕќ next-key lockсђѓ</p> <p>MVCC СИЇУЃйУДБтє│т╣╗У»╗жЌ«жбў№╝ї<strong>Next-Key жћЂт░▒Тў»СИ║С║єУДБтє│т╣╗У»╗жЌ«жбў</strong>сђѓтюетЈ»жЄЇтцЇУ»╗№╝ѕ<code>REPEATABLE READ</code>№╝Ѕжџћуд╗у║ДтѕФСИІ№╝їСй┐уће <strong>MVCC + Next-Key жћЂ</strong> тЈ»С╗ЦУДБтє│т╣╗У»╗жЌ«жбўсђѓ</p> <p>у┤бт╝ЋтѕєСИ║СИ╗жћ«у┤бт╝ЋтњїжЮъСИ╗жћ«у┤бт╝ЋСИцуДЇ№╝їтдѓТъюСИђТЮА SQL У»ГтЈЦТЊЇСйюС║єСИ╗жћ«у┤бт╝Ћ№╝їMySQL т░▒С╝џжћЂт«џУ┐ЎТЮАСИ╗жћ«у┤бт╝Ћ№╝ЏтдѓТъюСИђТЮАУ»ГтЈЦТЊЇСйюС║єжЮъСИ╗жћ«у┤бт╝Ћ№╝їMySQL С╝џтЁѕжћЂт«џУ»ЦжЮъСИ╗жћ«у┤бт╝Ћ№╝їтєЇжћЂт«џуЏИтЁ│уџёСИ╗жћ«у┤бт╝Ћсђѓтюе <code>UPDATE</code>сђЂ<code>DELETE</code> ТЊЇСйюТЌХ№╝їMySQL СИЇС╗ЁжћЂт«џ <code>WHERE</code> ТЮАС╗ХТЅФТЈЈУ┐ЄуџёТЅђТюЅу┤бт╝ЋУ«░тйЋ№╝їУђїСИћС╝џжћЂт«џуЏИжѓ╗уџёжћ«тђ╝№╝їтЇ│ТЅђУ░Њуџё <code>next-key lock</code>сђѓ</p> <p>тйЊСИцСИфС║ІтіАтљїТЌХТЅДУАї№╝їСИђСИфжћЂСйЈС║єСИ╗жћ«у┤бт╝Ћ№╝їтюеуГЅтЙЁтЁХС╗ќуЏИтЁ│у┤бт╝ЋсђѓтЈдСИђСИфжћЂт«џС║єжЮъСИ╗жћ«у┤бт╝Ћ№╝їтюеуГЅтЙЁСИ╗жћ«у┤бт╝ЋсђѓУ┐ЎТаит░▒С╝џтЈЉућЪТГ╗жћЂсђѓтЈЉућЪТГ╗жћЂтљј№╝ї<code>InnoDB</code> СИђУѕгжЃйтЈ»С╗ЦТБђТхІтѕ░№╝їт╣ХСй┐СИђСИфС║ІтіАжЄіТћЙжћЂтЏъжђђ№╝їтЈдСИђСИфУјитЈќжћЂт«їТѕљС║ІтіАсђѓ</p> <h2 id="_7-тЈѓУђЃУхёТќЎ"><a href="#_7-тЈѓУђЃУхёТќЎ" class="header-anchor">#</a> 7. тЈѓУђЃУхёТќЎ</h2> <ul><li><a href="https://book.douban.com/subject/23008813/" target="_blank" rel="noopener noreferrer">сђіжФўТђДУЃй MySQLсђІ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://time.geekbang.org/column/intro/100028001" target="_blank" rel="noopener noreferrer">сђіJava ТђДУЃйУ░ЃС╝ўт«ъТѕўсђІ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.md" target="_blank" rel="noopener noreferrer">ТЋ░ТЇ«т║Њу│╗у╗ЪтјЪуљє<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5b55b842f265da0f9e589e79" target="_blank" rel="noopener noreferrer">ТЋ░ТЇ«т║ЊСИцтцДуЦътЎесђљу┤бт╝ЋтњїжћЂсђЉ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/laoyeye/p/8097684.html" target="_blank" rel="noopener noreferrer">Сй┐уће mysql С╣љУДѓжћЂУДБтє│т╣ХтЈЉжЌ«жбў<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/db-tutorial/edit/master/docs/sql/mysql/mysql-lock.md" target="_blank" rel="noopener noreferrer">тИ«тіЕТѕЉС╗гТћ╣тќёТГцжАхжЮб№╝Ђ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/db-tutorial/assets/js/app.79266cfb.js" defer></script><script src="/db-tutorial/assets/js/4.26b0a8d7.js" defer></script><script src="/db-tutorial/assets/js/61.75308f0a.js" defer></script><script src="/db-tutorial/assets/js/5.1e6b02f3.js" defer></script>
  </body>
</html>
